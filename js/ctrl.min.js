var countx=3,county=4,Scenes=[],boxIndex=0,box=[],imageIndex=0,loadingIndex=0,loadingdef=$.Deferred(),callbackConfirm,iscroll,lastSelMusicObj,hasShowTip=!1;function closeShare(){$("#div_share").hide()}function share(){$(".share_btn").hide();$("#sharetip").css("display","block")}function setTempSize(){var c=Math.floor(.3*document.body.scrollWidth),b=Math.floor(260*c/200);$("#album_template_list").children("li").css("width",c);$("#album_template_list").children("li").css("height",b)}
function getImgScale(c,b,a){sh=Math.floor(b*a/c);return result={width:a,height:sh}}function calcImgClip(c,b,a,d){var g,e,f,h;return a/d>c/b?(e=b,g=Math.floor(a/d*b)):(g=c,e=Math.floor(d/a*c)),f=(g-c)/2,h=(e-b)/2,{objWidth:g,objHeight:e,clipLeft:f,clipTop:h}}
function loadUserImages(){var c=$("#player_loadingText");c.css("margin-top",$(window).height()/2-30);c.css("margin-left",$(window).width()/2-50);c.css("display","block");for(var b=0;b<images.length;b++){var a=new Image;a.onload=function(){loadingIndex++;c.html("\u52a0\u8f7d\u4e2d...("+loadingIndex+"/"+images.length+")");loadingIndex==images.length&&loadingdef.resolve();1==loadingIndex&&(this.width>this.height?$("#wrapper_player_cover_bkgnd img").css("height","100%"):$("#wrapper_player_cover_bkgnd img").css("width",
"100%"))};a.src=images[b][1]}}function onConfirmClk(){null!=callbackConfirm&&callbackConfirm();showEditorContent(0)}
function onChangeTemplateClk(c){$("#editor_change_template").css("display","block");$("#editor_change_content").css("display","none");var b=document.body.scrollHeight,a=0,d="";0===c&&(d="\u6362\u6a21\u7248",a=.7*b,callbackConfirm=null);1==c&&(d="\u9009\u97f3\u4e50",a=.5*b,callbackConfirm=onAlbumMusicSelect);2==c&&($("#editor_change_content").css("display","block"),$("#editor_change_template").css("display","none"),d="\u6539\u6807\u9898",a=84,callbackConfirm=onSaveTitle);document.getElementById("editor_content_titlebar").getElementsByTagName("div")[0].innerText=
d;showEditorContent(1,a)}
function showEditorContent(c,b){var a=document.getElementById("editor_content");if(1==c){a.style.display="block";a.className="editor_content_show";$("#div_player").css("pointer-events","none");var d=document.body.scrollHeight,g=b+70;a.style.height=g+"px";a.style.top=d-g+"px";$("#editor_content_frm").css("height",g-70+"px");$("#editor_change_template").css("height",g-70+"px");$("#div_edit_scroll").css("height",g-75+"px")}else a.className="editor_content_hide",$("#div_player").css("pointer-events","auto")}
var staticUrl="../img/",templeView={templeViewElem:void 0,init:function(){this.templeViewElem=$("#TempleView");$("#templeGroup .templeItem").on("click",function(){changeTpl($(this).children("img:first").data("id"))})},showTempleView:function(){function c(){templeView.templeViewElem.css({"-moz-transform":"translate(0,-100%)","-webkit-transform":"translate(0,-100%)","-o-transform":"translate(0,-100%)","-ms-transform":"translate(0,-100%)",transform:"translate(0,-100%)"})}
var b={hot:"82 74 60 58 56 52 51 50 49 6 8 9 10 12 14 16 18 20 21 23 25 26 27 28 29 30 31 32 33 34 35 38 39 40 41 42 43 44 45 46 48".split(" "),"new":"71 63 51 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48".split(" "),xinqing:"85 82 81 77 76 74 73 71 70 62 61 54 52 50 48 46 45 44 42 3 9 10 16 20 24 29 34 35".split(" "),aiqing:"72 66 65 49 6 23 27 37".split(" "),fengjing:"69 64 63 58 55 41 8 56 11 18 21 33 25 36 38 39".split(" "),jieri:"87 86 88 83 80 79 68 67 51 13 14 15 28 30 22 43".split(" "),
ertong:"84 78 75 59 57 53 47 7 12 17 19".split(" "),d3:["1","2","4","5","31"]};void 0==this.templeViewElem?($("#saveOverlay").show(),$("#saveDescript").html(""),$.ajax({url:"../json/templates.min.json?t=9",error:function(b,c){console.log("error");console.log(c)},success:function(a){var d=a.templates,g=$("#templeGroup");a="";console.log(d);for(var e=0,f=d.length;e<f;++e)if("1"==d[e].isonline)for(var h=0;h<b.hot.length;h++)b.hot[h]==d[e].id&&(a+="<div class='templeItem'><img data-id='"+
d[e].id+"' src='"+staticUrl+""+d[e].pic+"'/>","1"==d[e]["new"]&&(a+="<img class='new_temple' src='../img/new.png'/>"),d[e].id==c_tp&&(a+="<img class='select_mb' src='../img/select.png'/>"),a+="<div style='width=100;''>"+d[e].title+"</div></div>");$(".TempSelet ul li").click(function(){var a="";$(".TempSelet ul li").removeClass("select");g.html("");$(this).addClass("select");for(var e=$(this).attr("data"),f=0,h=d.length;f<
h;++f)if("1"==d[f].isonline)for(var k=0;k<b[e].length;k++)b[e][k]==d[f].id&&(a+="<div class='templeItem'><img data-id='"+d[f].id+"' src='"+staticUrl+""+d[f].pic+"'/>","1"==d[f]["new"]&&(a+="<img class='new_temple' src='../img/new.png'/>"),d[f].id==c_tp&&(a+="<img class='select_mb' src='../img/select.png'/>"),a+="<div style='width=100;''>"+d[f].title+"</div></div>");g.append(a);templeView.init();c();$("#saveOverlay").hide()});
g.append(a);templeView.init();c();$("#saveOverlay").hide()}})):c()},hideTempleView:function(){this.templeViewElem.css({"-moz-transform":"translate(0,0%)","-webkit-transform":"translate(0,0%)","-o-transform":"translate(0,0%)","-ms-transform":"translate(0,0%)",transform:"translate(0,0%)"})}},musicView={chooseIdx:0,audioPlayer:void 0,musicViewElem:void 0,init:function(){this.musicViewElem=$("#MusicView");var c=$("#MusicItem"+c_music.id),b=$("#btn_play_music");0<c.length&&(this.audioPlayer=new Player(b,
c.eq(0).find(".musicStatus").data("info"),function(){}),this.audioPlayer.isPlay=!1,this.audioPlayer._play(),this.chooseIdx=c_music.id,c.addClass("select"));this.musicViewElem=$("#MusicView");b.on("click",function(){b.hasClass("on")})},initEdit:function(){var c=$("#MusicList");$("#MusicView .musicType span").on("click",function(){var b=$(this).attr("class");$(this).parent().attr("class",b);c.attr("class",b)});$("#MusicView #MusicList span").on("click",function(b){var a=$(this).parent().parent();a.hasClass("select")&&
a.toggleClass("lyric");b.stopImmediatePropagation();b.stopPropagation();b.preventDefault();return!1});$("#MusicCancel").on("click",function(){var b=$("#MusicItem"+c_music.id);if(musicView.chooseIdx!=c_music.id){var a=$("#MusicItem"+musicView.chooseIdx);0<a.length&&(a.eq(0).removeClass("select"),a.eq(0).removeClass("lyric"));a="";0<b.length&&(b.eq(0).addClass("select"),a=b.eq(0).find(".musicStatus").data("info"));musicView.audioPlayer._src(a);musicView.audioPlayer._load();musicView.chooseIdx=c_music.id}musicView.hideMusicView();
$("#AudioBtn").removeClass("c_btn_play_music_playing");$("#AudioBtn").removeClass("c_btn_play_music_paused")});$("#MusicSelect").on("click",function(){c_music.id=musicView.chooseIdx;musicView.hideMusicView();musicView.audioPlayer._audio.currentTime=0;musicView.audioPlayer.isPlay=!1;musicView.audioPlayer._play();$("#AudioBtn").addClass("c_btn_play_music_playing");$("#AudioBtn").removeClass("c_btn_play_music_paused");saveMusic()});$(".musicItem").on("click",function(){var b=$(this),a=$("#MusicItem"+
musicView.chooseIdx);0<a.length&&(a.eq(0).removeClass("select"),a.eq(0).removeClass("lyric"));b.addClass("select");b.addClass("lyric");musicView.chooseIdx=parseInt(b.eq(0)[0].id.match(/\d+/)[0]);a=b.eq(0).find(".musicStatus").data("info");c_music.musicUrl=b.eq(0).find(".musicStatus").data("info");c_music.name=b.eq(0).find(".musicStatus").data("name");void 0==musicView.audioPlayer?(musicView.audioPlayer=new Player($("#AudioBtn"),a,function(){}),musicView.audioPlayer.isPlay=!1,musicView.audioPlayer._play()):
(musicView.audioPlayer._src(a),musicView.audioPlayer._load())})},isInit:!1,showMusicView:function(){function c(){musicView.musicViewElem.css({"-moz-transform":"translate(0,-100%)","-webkit-transform":"translate(0,-100%)","-o-transform":"translate(0,-100%)","-ms-transform":"translate(0,-100%)",transform:"translate(0,-100%)"})}0==musicView.isInit?($("#saveOverlay").show(),$("#saveDescript").html(""),$.ajax({url:"../json/musiclist.min.json",error:function(b,a){console.log("error");
console.log(a)},success:function(b){b=b.musiclist;for(var a=$("#MusicList"),d="",g=0,e=b.length;g<e;++g){var f=b[g];f.id!=c_music.id&&(d+="<li class='"+f.type+"'><div id='MusicItem"+f.id+"' class='musicItem'><div class='musicItemTitle'>"+f.name+"</div><div class='musicItemAfter'><div class='musicStatus' data-name='"+f.name+"' data-info='"+f.musicUrl+"' data-lyric='",d=f.lyricUrl?d+(staticUrl+f.lyricUrl+"'></div>"):d+"'></div>",d+="<div class='clrBox'></div></div><div class='clrBox'></div></div></li>")}a.append(d);
musicView.initEdit();c();musicView.isInit=!0;$("#saveOverlay").hide()}})):c()},hideMusicView:function(){this.musicViewElem.css({"-moz-transform":"translate(0,0%)","-webkit-transform":"translate(0,0%)","-o-transform":"translate(0,0%)","-ms-transform":"translate(0,0%)",transform:"translate(0,0%)"})}};
function search(){$(".serch li.serch").remove();$("#custom").remove();var c=$("#keyword").val();$("#MusicList").attr("class","serch");$.post("/index.php?g=Wap&m=Photo&a=serchmusic&bookname=oz9LKwdMutuuk7AZno0sbZsdCAZ4wqlcms1480574126&token=hrttor1464854411&keyword="+c,function(b){$("#MusicList").attr("class","serch");$("#MusicList").append(b);musicView.initEdit()})}function appPauseMusic(){musicView.audioPlayer.isPlay=!0;musicView.audioPlayer._play()}
function appPlayMusic(){musicView.audioPlayer.isPlay=!1;musicView.audioPlayer._play()}function androidMusicInit(){musicView.audioPlayer.isPlay=!1;musicView.audioPlayer._play()}function escapeHtml(c){if(0==c.length)return"";var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"," ":"&nbsp;"};return c.replace(/[&<>"' ]/g,function(a){return b[a]})}
function decodeEscapeHtml(c){if(0==c.length)return"";var b={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'","&nbsp;":" "};return c.replace(/(&nbsp;|&amp;|&lt;|&gt;|&quot;|&#039;)/g,function(a){return b[a]})}function Player(c,b,a,d){this.el=c;this.isPlay=!1;void 0==b&&(b="");this.init(b,a,d)}
Player.prototype={init:function(c,b,a){var d=this,g={loop:!1,preload:"auto",autoplay:!0,src:c};this._audio=new Audio;for(var e in g)g.hasOwnProperty(e)&&e in this._audio&&(this._audio[e]=g[e]);this.inited=!1;$(this._audio).on("durationchange",function(){1<d._audio.duration&&b&&(d.inited=!0,b.call(a))});$(this._audio).on("ended",function(){d._audio.currentTime=0;b&&b.call(a);d.isPlay=!1;d._play()});""!=c&&this._audio.load();if("string"!==typeof this.el)this.el.on("click",function(){d._play()})},_load:function(){this._audio.load()},
_src:function(c){this._audio.src=c},_isplay:function(){return this.isPlay},_play:function(){this.isPlay?(this._audio.pause(),"string"!==typeof this.el&&(this.el.removeClass("c_btn_play_music_playing"),this.el.addClass("c_btn_play_music_paused"))):(this._audio.play(),"string"!==typeof this.el&&(this.el.removeClass("c_btn_play_music_paused"),this.el.addClass("c_btn_play_music_playing")));this.isPlay=!this.isPlay},_playOn:function(){this._audio.play();"string"!==typeof this.el&&(this.el.removeClass("c_btn_play_music_paused"),
this.el.addClass("c_btn_play_music_playing"));this.isPlay=!0},_playOff:function(){this._audio.pause();"string"!==typeof this.el&&(this.el.removeClass("c_btn_play_music_playing"),this.el.addClass("c_btn_play_music_paused"));this.isPlay=!1}};
function search(){$(".serch li.serch").remove();$("#custom").remove();var c=$("#keyword").val();$("#MusicList").attr("class","serch");$.get("./searchmusic?name="+c,function(b){$("#MusicList").attr("class","serch");$("#MusicList").append(b);musicView.initEdit()})};